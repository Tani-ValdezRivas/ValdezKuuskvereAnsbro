---
title: "Trends in giant kelp nitrogen surge uptake"
author: "Erin Ansbro, Cara Kuuskvere, Tani Valdez Rivas"
date: "December 2023"
output: 
  html_document:
    toc: true
---
\newpage
\tableofcontents
\newpage
\listoftables 
\newpage
\listoffigures 
\newpage

```{r include=FALSE}
# Set your working directory
library(here)
here()

# Loading packages
library(tidyverse)
library(lubridate)
library(cowplot)
library(knitr)
library(sf)
library(leaflet)
library(mapview); mapviewOptions(fgb = FALSE)

# Reading in the data
SurgeUptakeNitrogen <-
  read.csv(here('Data','Processed','Nitrogen_Processed.csv'), stringsAsFactors=TRUE)

# Set your ggplot theme
#Create and set theme 
mytheme <- theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
theme_set(mytheme)

# Load your datasets
SurgeUptakeNitrogen <-
  read.csv(here('Data','Processed','Nitrogen_Processed.csv'), stringsAsFactors=TRUE)

NitrogenYears <-read.csv(here('Data','Processed','NitrogenYears_Processed.csv'), stringsAsFactors=TRUE)

#Verifying data attributes
SurgeUptakeNitrogen$Time <- as.factor(SurgeUptakeNitrogen$Time)
SurgeUptakeNitrogen$Blade_Replicate <- as.factor(SurgeUptakeNitrogen$Blade_Replicate)
SurgeUptakeNitrogen$Day_Replicate <- as.factor(SurgeUptakeNitrogen$Day_Replicate)

```


# Rationale and Research Questions

As climate change related issues continue to arise throughout the world, ecosystem services have been called upon to combat disasters. Nature-based solutions have been a rising trend in recent years, and they speak to the resilience that nature made flora has embedded into their structure (Seddon, 2020). Kelp forests along the United States west coast are impacted by increasing temperatures as a result of climate change. Kelp grows quickly and can sequester a large amount of carbon, aiding in the resilience of climate-change (Hurlimann, 2019). A recent study has shown that increased nitrogen uptake by kelp can limit the effect that heat has on them. This is an interesting development because nitrogen increase in California waters is related to agriculture runoff, and eutrophication is generally seen as a negative consequence of human interference. However, in this case, it assists kelp and helps them survive increased climate-change related temperature increase (Fernández, 2020).

Interested in this recent research, data about nitrogen uptake was located in the Long-Term Ecological Research database titled “SBC LTER: Reef: Surge uptake capability in Macrocystis pyrifera in response to pulses of three different forms of nitrogen” (Cedeno, 2021). This data set looked simple enough to clean while also providing enough information for a research project. 

We are interested in trends in giant kelp nitrogen surge uptake by season and by the amount of exposure. Specific questions include:

1. Does giant kelp nitrogen surge uptake vary per spring and summer season?
2. Does giant kelp nitrogen surge uptake vary based on the amount of exposure?
3. Does uptake vary by type of nitrogen (ammonium, nitrate, and urea)?

Github Information: https://github.com/Tani-ValdezRivas/ValdezKuuskvereAnsbro


\newpage

# Dataset Information

Data sets were found on the Environmental Data Initiative. All sets were from the Santa Barbara Coastal Long Term Ecological Research Site (SBC LTER) which is based  within the University of California, Santa Barbara (UCSB) Marine Science Institute, and is part of the National Science Foundation's LTER Network. 

The first data set focuses on one experiment done that examines nitrogen and biomass uptake by kelp during timed nitrogen blasting.  The first data set was used to determine if nitrogen uptake varies by time (minutes), season, or nitrogen type. The second data set has dates and percent nitrogen of kelp over almost a twenty year period. This second data set was used to gain a general sense of nitrogen found in kelp in Santa Barbara, CA and to see if that has changed over time.

Table: Data Set Information

Detail | Data Set 1 | Data Set 2
-----:|:----:|:----:
Source| Santa Barbara Coastal Long Term Ecological Research (LTER) | Santa Barbara Coastal  Long Term Ecological Research (LTER)
Retrieved from | https://portal.edirepository.org/nis/mapbrowse?packageid=edi.1022.2 |https://sbclter.msi.ucsb.edu/data/catalog/package/?package=knb-lter-sbc.24
Variables Used | Nitrogen Types, Season, Day Replicate, Time, Blade Replicate, Uptake Rate, Biomass Uptake Rate |Year, Month, Date, Nitrogen Percent
Date | 2021 | 2002-2021

The data for nitrogen uptake was cleaned by renaming the column names to be better understood by the public. Multiple columns including columns for Blade Replicate, Day Replicate, Time, Season, and Nitrogen Type were changed to factors. Season and Nitrogen Type also had labels added to capitalize the names of seasons and nitrogen types.Data cleaning for the second data set entailed renaming column names as well. Date was changed from a factor to a date data type. Sites with missing values were also removed. 

\newpage

# Exploratory Analysis 

The Map shows the sampling sites of nitrogen uptake along the coast of California
```{r Map, echo=FALSE, message=FALSE}

# Data Exploration Part 1: Mapping the locations of the study sites

# Creating a data frame of the locations
Site_Name <- c("Mohawk Reef", "Arroyo Quemado Reef", "Arroyo Burro Reef")
Longitude <- c("-119.7295", "-120.11905", "-119.7445915	")
Latitude <- c("34.3940708", "34.46774988", "34.400275")

Site_information <- data.frame(Site_Name, Longitude, Latitude)

# Changing Site Name, Longitude, Latitude to factors and numerics
Site_information$Site_Name <- as.factor(Site_information$Site_Name)
Site_information$Longitude <- as.numeric(Site_information$Longitude)
Site_information$Latitude <- as.numeric(Site_information$Latitude)


# Converting the dataframe into a spatial reference frame
Surge_Reef_sf <- Site_information %>% 
  st_as_sf(coords = c('Longitude','Latitude'),
           crs=4326)

# Making a map of the study sites
Surge_Reef_Map <- mapview(Surge_Reef_sf, layer.name = 'Reef Site locations')
Surge_Reef_Map
```

```{r Box Plots, echo=FALSE, message=FALSE}
# Data Exploration Part 2.1: Box Plots to visualize data means and quartiles
UptakeRateBoxbyType <- ggplot(SurgeUptakeNitrogen) +
  geom_boxplot(aes(x = Nitrogen_Types, y = Uptake_Rate))+
  labs(title="Uptake Rate (V(hr1)) by Nitrogen Type")
UptakeRateBoxbyType
ggsave(file=here('Output', 'BoxDataExp','UptakeRateBoxbyType.png'), width = 10, height = 10, units = "cm")

BiomassBoxbyType <- ggplot(SurgeUptakeNitrogen) +
  geom_boxplot(aes(x = Nitrogen_Types, y = Biomass_Uptake))+
  labs(title= "Biomass Uptake by Nitrogen Type")
BiomassBoxbyType
ggsave(file=here('Output','BoxDataExp', 'BiomassBoxbyType.png'), width = 10, height = 10, units = "cm")

UptakeRateBoxbySeason <- ggplot(SurgeUptakeNitrogen) +
  geom_boxplot(aes(x = Season, y = Uptake_Rate))+
  labs(title="Uptake Rate (V(hr1)) by Season")
UptakeRateBoxbySeason
ggsave(file=here('Output', 'BoxDataExp','UptakeRateBoxbySeason.png'), width = 10, height = 10, units = "cm")

BiomassBoxbySeason <- ggplot(SurgeUptakeNitrogen) +
  geom_boxplot(aes(x = Season, y = Biomass_Uptake))+
  labs(title= "Biomass Uptake by Season")
BiomassBoxbySeason
ggsave(file=here('Output','BoxDataExp', 'BiomassBoxbySeason.png'), width = 10, height = 10, units = "cm")

UptakeRateBoxbyTime <- ggplot(SurgeUptakeNitrogen) +
  geom_boxplot(aes(x = Time, y = Uptake_Rate))+
  labs(title="Uptake Rate (V(hr1)) by Length of Exposure")
UptakeRateBoxbyTime
ggsave(file=here('Output','BoxDataExp', 'UptakeRateBoxbyTime.png'), width = 10, height = 10, units = "cm")

BiomassBoxbyTime <- ggplot(SurgeUptakeNitrogen) +
  geom_boxplot(aes(x = Time, y = Biomass_Uptake))+
  labs(title= "Biomass Uptake by Length of Exposure")
BiomassBoxbyTime
ggsave(file=here('Output','BoxDataExp', 'BiomassBoxbyTime.png'), width = 10, height = 10, units = "cm")

UptakeRateBoxbyDayRep <- ggplot(SurgeUptakeNitrogen) +
  geom_boxplot(aes(x = Day_Replicate, y = Uptake_Rate))+
  labs(title="Uptake Rate (V(hr1)) by Day Replicate")
UptakeRateBoxbyDayRep
ggsave(file=here('Output', 'BoxDataExp','UptakeRateBoxbyDayRep.png'), width = 10, height = 10, units = "cm")

BiomassBoxbyDayRep <- ggplot(SurgeUptakeNitrogen) +
  geom_boxplot(aes(x = Day_Replicate, y = Biomass_Uptake))+
  labs(title= "Biomass Uptake by Day Replicate")
BiomassBoxbyDayRep
ggsave(file=here('Output','BoxDataExp', 'BiomassBoxbyDayRep.png'), width = 10, height = 10, units = "cm")

UptakeRateBoxbyBladeRep <- ggplot(SurgeUptakeNitrogen) +
  geom_boxplot(aes(x = Blade_Replicate, y = Uptake_Rate))+
  labs(title="Uptake Rate (V(hr1)) by Blade Replicate")
UptakeRateBoxbyBladeRep
ggsave(file=here('Output','BoxDataExp', 'UptakeRateBoxbyBladeRep.png'), width = 10, height = 10, units = "cm")

BiomassBoxbyBladeRep <- ggplot(SurgeUptakeNitrogen) +
  geom_boxplot(aes(x = Blade_Replicate, y = Biomass_Uptake))+
  labs(title= "Biomass Uptake by Blade Replicate")
BiomassBoxbyBladeRep
ggsave(file=here('Output', 'BoxDataExp','BiomassBoxbyBladeRep.png'), width = 10, height = 10, units = "cm")
```



```{r Violins, echo=FALSE, message=FALSE}
# Data Exploration Part 2.2: Violins to visualize range and spread of each component of the data set
UptakeRateViolinbyType <- ggplot(SurgeUptakeNitrogen) +
  geom_violin(aes(x = Nitrogen_Types, y = Uptake_Rate))+
  labs(title="Uptake Rate (V(hr1)) by Nitrogen Type")
UptakeRateViolinbyType
ggsave(file=here('Output','ViolinDataExp', 'UptakeRateViolinbyType.png'), width = 10, height = 10, units = "cm")

BiomassViolinbyType <- ggplot(SurgeUptakeNitrogen) +
  geom_violin(aes(x = Nitrogen_Types, y = Biomass_Uptake))+
  labs(title= "Biomass Uptake by Nitrogen Type")
BiomassViolinbyType
ggsave(file=here('Output', 'ViolinDataExp','BiomassViolinbyType.png'), width = 10, height = 10, units = "cm")

UptakeRateViolinbySeason <- ggplot(SurgeUptakeNitrogen) +
  geom_violin(aes(x = Season, y = Uptake_Rate))+
  labs(title="Uptake Rate (V(hr1)) by Season")
UptakeRateViolinbySeason
ggsave(file=here('Output','ViolinDataExp', 'UptakeRateViolinbySeason.png'), width = 10, height = 10, units = "cm")

BiomassViolinbySeason <- ggplot(SurgeUptakeNitrogen) +
  geom_violin(aes(x = Season, y = Biomass_Uptake))+
  labs(title= "Biomass Uptake by Season")
BiomassViolinbySeason
ggsave(file=here('Output','ViolinDataExp', 'BiomassViolinbySeason.png'), width = 10, height = 10, units = "cm")

UptakeRateViolinbyTime <- ggplot(SurgeUptakeNitrogen) +
  geom_violin(aes(x = Time, y = Uptake_Rate))+
  labs(title="Uptake Rate (V(hr1)) by Length of Exposure")
UptakeRateViolinbyTime
ggsave(file=here('Output', 'ViolinDataExp','UptakeRateViolinbyTime.png'), width = 10, height = 10, units = "cm")

BiomassViolinbyTime <- ggplot(SurgeUptakeNitrogen) +
  geom_violin(aes(x = Time, y = Biomass_Uptake))+
  labs(title= "Biomass Uptake by Length of Exposure")
BiomassViolinbyTime
ggsave(file=here('Output', 'ViolinDataExp','BiomassViolinbyTime.png'), width = 10, height = 10, units = "cm")

UptakeRateViolinbyDayRep <- ggplot(SurgeUptakeNitrogen) +
  geom_violin(aes(x = Day_Replicate, y = Uptake_Rate))+
  labs(title="Uptake Rate (V(hr1)) by Day Replicate")
UptakeRateViolinbyDayRep
ggsave(file=here('Output', 'ViolinDataExp','UptakeRateViolinbyDayRep.png'), width = 10, height = 10, units = "cm")

BiomassViolinbyDayRep <- ggplot(SurgeUptakeNitrogen) +
  geom_violin(aes(x = Day_Replicate, y = Biomass_Uptake))+
  labs(title= "Biomass Uptake by Day Replicate")
BiomassViolinbyDayRep
ggsave(file=here('Output', 'ViolinDataExp','BiomassViolinbyDayRep.png'), width = 10, height = 10, units = "cm")

UptakeRateViolinbyBladeRep <- ggplot(SurgeUptakeNitrogen) +
  geom_violin(aes(x = Blade_Replicate, y = Uptake_Rate))+
  labs(title="Uptake Rate (V(hr1)) by Blade Replicate")
UptakeRateViolinbyBladeRep
ggsave(file=here('Output', 'ViolinDataExp','UptakeRateViolinbyBladeRep.png'), width = 10, height = 10, units = "cm")

BiomassViolinbyBladeRep <- ggplot(SurgeUptakeNitrogen) +
  geom_violin(aes(x = Blade_Replicate, y = Biomass_Uptake))+
  labs(title= "Biomass Uptake by Blade Replicate")
BiomassViolinbyBladeRep
ggsave(file=here('Output', 'ViolinDataExp','BiomassViolinbyBladeRep.png'), width = 10, height = 10, units = "cm")

```

```{r Nitrogen Data Exploration, echo=FALSE, message=FALSE}
#Data Exploration Part 3
summary(NitrogenYears)

summary(NitrogenYears$Nitrogen_Percent)

NitrogenYears_Point <- ggplot(NitrogenYears, aes(x=Year, y=Nitrogen_Percent))+
  geom_point(alpha=.5)+
  labs(title="Nitrogen Percent by Year", x="Date", y="Nitrogen Percent")

print(NitrogenYears_Point)

NitrogenYears_Box <- ggplot(NitrogenYears, aes(x=NewSites, y=Nitrogen_Percent))+
  geom_boxplot()+
  labs(title="Nitrogen Percent by Site", x="Site", y="Nitrogen Percent")

print(NitrogenYears_Box)
```

\newpage

# Analysis


## Question 1: Does giant kelp nitrogen percent vary over year or season?

H0 : There is no significant difference of nitrogen percent over the past twenty years.
HA : There is significant difference of nitrogen percent over the past twenty years.

Prior to conducting this analysis, it was identified that nitrogen percent did not seem to visually change over the years. To get a better understanding..... 
```{r}

```




## Question 2: Does giant kelp nitrogen and ammonia surge uptake vary per spring and summer season?
H0 : There is no significant difference of nitrogen surge uptake between spring and summer seasons.
HA : There is significant difference of nitrogen surge uptake between spring and summer seasons.

The metadata indicates that the giant kelp blades studied were collected during the nitrate replete spring and the nitrate-deplete summer. The five replicate experiments were conducted in both spring and summer of 2019, which allows us to find potential differences in the nitrogen surge uptake of the two populations. The experimenters calculate uptake rate using a modified version of an equation by Legendre and Grosselin (1997) V= (nt - n0)/[t(ds-d0)] where nt is the atom percentage of Nitrogen-15 in the blade after incubation; n0 is the average concentration of isotope in the control blades; ds is the atom percentage of Nitrogen-15 in the seawater at the start of the incubation; d0 is the atom percentage of Nitrogen-15 in the nitrate pool before isotope tracer was added; and t is the length of the incubation time in minutes.

```{r}

```


## Question 3:  Does giant kelp nitrogen and ammonia surge uptake vary based on the amount of exposure?
H0 : There is no significant difference of nitrogen surge uptake between 
different exposure lengths.
HA : There is significant difference of nitrogen surge uptake between different
exposure lengths.
```{r}

```


## Question 4: Does uptake vary by type of nitrogen (ammonium, nitrate, and urea)?

```{r}

```


\newpage

# Summary and Conclusions


\newpage

# References
Cedeno, T., Brzezinski, M., Miller, R., Reed, D. (2021). Santa Barbara Coastal LTER: Reef: Surge uptake capability in Macrocystis pyrifera in response to pulses of three different forms of nitrogen ver 1. Environmental Data Initiative. https://doi.org/10.6073/pasta/d079ff0e95defb71b87040f56235d755 

Fernández, P.A., Gaitán-Espitia, J.D., Leal, P.P. et al. (2020). Nitrogen sufficiency enhances thermal tolerance in habitat-forming kelp: implications for acclimation under thermal stress. Scientific Reports 10, 3186.https://doi.org/10.1038/s41598-020-60104-4

Legendre, L., Gosselin, M., (1997). Estimation of N or C uptake rates by phytoplankton using 15N or 13C: revisiting the usual computation formulae, Journal of Plankton Research, Volume 19, Issue 2, February 1997, Pages 263–271
Hurlimann, S. (2019, July 4). How kelp naturally combats global climate change. Science in the News.https://sitn.hms.harvard.edu/flash/2019/how-kelp-naturally-combats-global-climate-change/  

Seddon N., Chausson A., Berry P., Girardin Cécile A. J., Smith A., Turner B. (2020). Understanding the value and limits of nature-based solutions to climate change and other global challenges. The Royal Society 375, 1794. http://doi.org/10.1098/rstb.2019.0120 

